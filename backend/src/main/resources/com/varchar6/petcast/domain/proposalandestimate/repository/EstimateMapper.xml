<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.varchar6.petcast.domain.proposalandestimate.query.mapper.EstimateMapper">

    <!-- 고객 기획서 목록 조회 -->
    <select id="findAllEstimatesByMemberId" resultType="com.varchar6.petcast.domain.proposalandestimate.query.mapper.EstimateMapper">
        SELECT e.id AS estimate_id,
               e.cost AS estimate_cost,
               e.status AS estimate_status,
               e.created_at AS estimate_created_at,
               e.updated_at AS estimate_updated_at,
               e.active AS estimate_active,
               p.id AS proposal_id,
               p.location AS proposal_location,
               p.time AS proposal_time,
               p.content AS proposal_content,
               p.status AS proposal_status,
               p.cost AS proposal_cost,
               p.created_at AS proposal_created_at,
               p.updated_at AS proposal_updated_at,
               p.active AS proposal_active,
               p.member_proposal_id AS customer_id
        FROM tbl_estimate e
                 JOIN tbl_proposal p ON e.proposal_estimate_id = p.id
        WHERE p.member_proposal_id = #{고객 id}
        ORDER BY e.created_at DESC;

    </select>

    <!-- 업체 기획서 목록 조회 -->
    <select id="findAllEstimatesByCompanyId" resultType="com.varchar6.petcast.domain.proposalandestimate.query.mapper.EstimateMapper">
        SELECT e.id AS estimate_id,
               e.cost AS estimate_cost,
               e.status AS estimate_status,
               e.created_at AS estimate_created_at,
               e.updated_at AS estimate_updated_at,
               e.active AS estimate_active,
               e.proposal_estimate_id AS proposal_id,
               e.company_info_estimate_id AS company_id
        FROM tbl_estimate e
        WHERE e.company_info_estimate_id = #{업체 id}
        ORDER BY e.created_at DESC;

    </select>

    <!-- 고객 특정 기획서 조회 -->
    <select id="findEstimateById" parameterType="int" resultType="com.varchar6.petcast.domain.proposalandestimate.query.mapper.EstimateMapper">
        SELECT
            e.id AS estimate_id,
            e.cost,
            e.status,
            e.created_at,
            e.updated_at,
            e.active_yn,
            c.name AS company_name,
            p.id AS proposal_id,
            p.location,
            p.time,
            p.content
        FROM
            tbl_estimate e
                INNER JOIN tbl_company_info c ON e.company_info_estimate_id = c.id
                INNER JOIN tbl_proposal p ON e.proposal_estimate_id = p.id
        WHERE
            e.id = #{견적서_id}
    </select>

</mapper>